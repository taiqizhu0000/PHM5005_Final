# Stage 3B: 基因通路深度分析报告

## 分析概述

本分析使用**仅基因特征**的模型，深入研究各基因和通路在预测子宫内膜癌风险中的作用。

### 数据规模
- 训练样本: 289
- 测试样本: 73
- 基因特征数: 879
- 通路数: 7

### 模型配置
- Pipeline: StandardScaler → SelectKBest(k=500) → ElasticNet Logistic Regression
- 验证策略: 5-Fold × 3 重复 = 15次训练
- Permutation Importance: n_repeats=10

---

## 重要性指标对比

### Importance Score vs Permutation Importance

| 指标 | 定义 | 优势 | 更适合 |
|------|------|------|--------|
| **Importance Score** | 频率 × \|系数中位数\| | 反映模型使用频率和系数大小 | 理解模型偏好 |
| **Permutation Importance** ⭐ | 打乱特征后性能下降幅度 | 直接衡量实际贡献 | **评估真实重要性** |

**结论**: Permutation Importance 更能体现特征在分类中的重要作用，因为它测量了该特征对模型预测能力的实际影响。

### 基因层面相关性

- **被选中的基因数**: 585 / 879 (66.6%)
- **高频基因 (>50%)**: 160
- **两指标相关性** (仅被选中基因):
  - Pearson r = 0.035
  - Spearman r = 0.042

---

## Top 50 基因

### 按 Importance Score 排名

| 排名 | 基因 | 通路 | 选择频率 | 系数中位数 | Importance Score |
|------|------|------|----------|-----------|-----------------|
| 1 | DUSP6 | MAPK_hsa04010 | 1.00 | -0.6285 | 0.6285 |
| 2 | FGF16 | PI3K_Akt_hsa04151 | 0.93 | +0.6484 | 0.6052 |
| 3 | CACNG5 | MAPK_hsa04010 | 0.93 | -0.6124 | 0.5716 |
| 4 | GADD45A | p53_hsa04115 | 0.87 | -0.6532 | 0.5661 |
| 5 | PRR5L | mTOR_hsa04150 | 0.93 | -0.5533 | 0.5164 |
| 6 | PRR5 | mTOR_hsa04150 | 1.00 | -0.4719 | 0.4719 |
| 7 | YWHAG | PI3K_Akt_hsa04151 | 1.00 | +0.4562 | 0.4562 |
| 8 | PPP2R2C | PI3K_Akt_hsa04151 | 0.73 | -0.5985 | 0.4389 |
| 9 | OSMR | PI3K_Akt_hsa04151 | 0.93 | +0.4643 | 0.4334 |
| 10 | PIK3C2B | IGF1_signaling | 0.93 | +0.4517 | 0.4216 |
| 11 | SERPINB5 | p53_hsa04115 | 0.73 | +0.5564 | 0.4080 |
| 12 | PTEN | PI3K_Akt_hsa04151 | 0.53 | -0.7596 | 0.4051 |
| 13 | CACNA2D1 | MAPK_hsa04010 | 0.87 | +0.4662 | 0.4040 |
| 14 | HSP90AA1 | PI3K_Akt_hsa04151 | 1.00 | +0.3906 | 0.3906 |
| 15 | SLC38A9 | mTOR_hsa04150 | 0.93 | -0.4162 | 0.3884 |
| 16 | MAP2K2 | PI3K_Akt_hsa04151 | 0.93 | -0.4047 | 0.3778 |
| 17 | ATF6B | PI3K_Akt_hsa04151 | 0.87 | +0.4214 | 0.3652 |
| 18 | LPIN1 | mTOR_hsa04150 | 0.80 | +0.4503 | 0.3602 |
| 19 | TLE3 | WNT_hsa04310 | 0.87 | -0.3934 | 0.3410 |
| 20 | HSPA1B | MAPK_hsa04010 | 0.93 | +0.3649 | 0.3406 |

### 按 Permutation Importance 排名

| 排名 | 基因 | 通路 | Perm Importance | 标准差 | Importance Score |
|------|------|------|----------------|--------|-----------------|
| 1 | NPRL2 | mTOR_hsa04150 | +0.0609 | 0.0197 | 0.0000 |
| 2 | SGK1 | PI3K_Akt_hsa04151 | +0.0477 | 0.0262 | 0.0101 |
| 3 | IFNA21 | PI3K_Akt_hsa04151 | +0.0442 | 0.0130 | 0.0265 |
| 4 | FGF22 | PI3K_Akt_hsa04151 | +0.0275 | 0.0126 | 0.0471 |
| 5 | RRAGD | mTOR_hsa04150 | +0.0248 | 0.0088 | 0.0069 |
| 6 | MAPK1 | PI3K_Akt_hsa04151 | +0.0233 | 0.0109 | 0.0000 |
| 7 | DVL3 | WNT_hsa04310 | +0.0217 | 0.0072 | 0.0198 |
| 8 | EIF4EBP1 | PI3K_Akt_hsa04151 | +0.0216 | 0.0083 | 0.0541 |
| 9 | RRAGA | mTOR_hsa04150 | +0.0209 | 0.0106 | 0.2639 |
| 10 | EFNA3 | PI3K_Akt_hsa04151 | +0.0206 | 0.0136 | 0.2539 |
| 11 | STMN1 | MAPK_hsa04010 | +0.0206 | 0.0201 | 0.0293 |
| 12 | PDGFD | PI3K_Akt_hsa04151 | +0.0196 | 0.0051 | 0.0000 |
| 13 | IRAK4 | MAPK_hsa04010 | +0.0187 | 0.0197 | 0.1458 |
| 14 | RAF1 | PI3K_Akt_hsa04151 | +0.0173 | 0.0146 | 0.0000 |
| 15 | CACNG6 | MAPK_hsa04010 | +0.0169 | 0.0029 | 0.0500 |
| 16 | MAP3K11 | MAPK_hsa04010 | +0.0165 | 0.0092 | 0.0000 |
| 17 | RAC2 | WNT_hsa04310 | +0.0163 | 0.0134 | 0.0000 |
| 18 | EP300 | WNT_hsa04310 | +0.0157 | 0.0082 | 0.0969 |
| 19 | SIRT1 | WNT_hsa04310 | +0.0155 | 0.0066 | 0.0000 |
| 20 | POLD4 | MMR_hsa03430 | +0.0151 | 0.0139 | 0.1655 |

---

## 通路级别分析

### 通路排名（按标准化 Importance Score）

| 排名 | 通路 | 基因数 | 选中率 | Norm. Imp Score | Norm. Perm Imp |
|------|------|--------|--------|----------------|----------------|
| 1 | mTOR_hsa04150 | 67 | 67.2% | 0.0718 | +0.0015 |
| 2 | p53_hsa04115 | 56 | 76.8% | 0.0663 | -0.0005 |
| 3 | MMR_hsa03430 | 23 | 87.0% | 0.0632 | +0.0012 |
| 4 | MAPK_hsa04010 | 159 | 69.2% | 0.0530 | -0.0001 |
| 5 | PI3K_Akt_hsa04151 | 351 | 66.4% | 0.0486 | +0.0005 |
| 6 | IGF1_signaling | 43 | 58.1% | 0.0385 | -0.0018 |
| 7 | WNT_hsa04310 | 174 | 62.1% | 0.0369 | +0.0003 |

### 标准化方法说明

为了公平比较不同大小的通路，我们使用**标准化分数**：

```
Normalized Score = Sum(基因得分) / 基因数量
```

这样可以避免大通路仅因基因数量多而得分高的偏差。

### 通路特征汇总

| 通路 | 基因数 | Max Imp Score | Max Perm Imp | 总和 Imp Score | 总和 Perm Imp |
|------|--------|--------------|--------------|---------------|---------------|
| mTOR_hsa04150 | 67 | 0.5164 | +0.0609 | 4.8103 | +0.1035 |
| p53_hsa04115 | 56 | 0.5661 | +0.0074 | 3.7135 | -0.0273 |
| MMR_hsa03430 | 23 | 0.2766 | +0.0151 | 1.4536 | +0.0267 |
| MAPK_hsa04010 | 159 | 0.6285 | +0.0206 | 8.4288 | -0.0084 |
| PI3K_Akt_hsa04151 | 351 | 0.6052 | +0.0477 | 17.0582 | +0.1605 |
| IGF1_signaling | 43 | 0.4216 | +0.0062 | 1.6544 | -0.0770 |
| WNT_hsa04310 | 174 | 0.3410 | +0.0217 | 6.4174 | +0.0564 |

---

## 关键发现

### 1. 最重要的基因（综合两指标）

交集分析 - 同时出现在两个Top 20中的基因：


⚠️ 两个Top 20中没有重叠基因，说明两种指标捕捉到不同的特征重要性维度。


### 2. 最重要的通路

按标准化Importance Score排名：

1. **mTOR_hsa04150**
   - 基因数: 67
   - 标准化Importance Score: 0.0718
   - 标准化Permutation Importance: +0.0015
   - 选中率: 67.2%

2. **p53_hsa04115**
   - 基因数: 56
   - 标准化Importance Score: 0.0663
   - 标准化Permutation Importance: -0.0005
   - 选中率: 76.8%

3. **MMR_hsa03430**
   - 基因数: 23
   - 标准化Importance Score: 0.0632
   - 标准化Permutation Importance: +0.0012
   - 选中率: 87.0%


### 3. 指标差异分析

- **高Importance Score但低Permutation Importance**: 可能是冗余特征（与其他特征高度相关）
- **低Importance Score但高Permutation Importance**: 可能是被忽略但实际很重要的特征
- **两者都高**: 真正重要且稳定的特征

---

## 生物学解释

### 重要基因的功能

基于Top基因和通路分析，以下机制可能与子宫内膜癌风险相关：

1. **细胞增殖和生长** (PI3K-Akt, IGF1, mTOR通路)
2. **信号转导** (MAPK, WNT通路)
3. **DNA修复** (MMR通路)
4. **细胞周期调控** (p53通路)

---

## 输出文件

- `gene_importance_full.csv`: 所有基因的完整重要性统计
- `top50_by_importance_score.csv`: Top 50基因（按Importance Score）
- `top50_by_permutation_importance.csv`: Top 50基因（按Permutation Importance）
- `pathway_summary.csv`: 通路级别汇总统计
- `gene_pathway_analysis.png`: 综合可视化

---

生成时间: {pd.Timestamp.now().strftime('%Y-%m-%d %H:%M:%S')}
